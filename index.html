<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Battleship Radar Command</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Orbitron', monospace;
      background: radial-gradient(circle at center, #0a1a0a 0%, #000 70%);
      color: #00ff41;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      overflow-x: auto;
    }

    .radar-container {
      background: linear-gradient(145deg, #001100, #002200);
      border: 2px solid #00ff41;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 
        0 0 30px #00ff4150,
        inset 0 0 20px #00330a;
      max-width: 1400px;
      width: 100%;
    }

    .command-header {
      text-align: center;
      margin-bottom: 20px;
      background: linear-gradient(90deg, #003300, #001a00, #003300);
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #00ff41;
      box-shadow: 0 0 15px #00ff4130;
    }

    .command-header h1 {
      font-size: 2.2em;
      font-weight: 900;
      letter-spacing: 3px;
      text-shadow: 0 0 10px #00ff41;
      margin-bottom: 10px;
      animation: glow 2s ease-in-out infinite alternate;
    }

    @keyframes glow {
      from { text-shadow: 0 0 10px #00ff41, 0 0 20px #00ff41; }
      to { text-shadow: 0 0 20px #00ff41, 0 0 30px #00ff41, 0 0 40px #00ff41; }
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(90deg, #001a00, #002200);
      padding: 10px 20px;
      border-radius: 8px;
      border: 1px solid #00ff41;
      margin-bottom: 20px;
      box-shadow: inset 0 2px 5px #00110050;
    }

    .mode-selector {
      display: flex;
      gap: 10px;
    }

    .mode-btn {
      background: linear-gradient(145deg, #003300, #001100);
      color: #00ff41;
      border: 1px solid #00ff41;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-family: 'Orbitron', monospace;
      font-weight: 700;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .mode-btn:hover, .mode-btn.active {
      background: linear-gradient(145deg, #00ff41, #00cc33);
      color: #000;
      box-shadow: 0 0 15px #00ff41;
      text-shadow: none;
    }

    .radar-stats {
      display: flex;
      gap: 20px;
      font-size: 0.9em;
      font-weight: 700;
    }

    .stat-item {
      text-align: center;
      background: linear-gradient(145deg, #001a00, #000800);
      padding: 5px 12px;
      border-radius: 5px;
      border: 1px solid #00ff4150;
      min-width: 80px;
    }

    .stat-value {
      font-size: 1.2em;
      color: #00ff41;
      text-shadow: 0 0 5px #00ff41;
    }

    .status-message {
      background: linear-gradient(90deg, #001100, #002200, #001100);
      color: #00ff41;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 1em;
      font-weight: 700;
      text-align: center;
      margin-bottom: 20px;
      border: 1px solid #00ff41;
      box-shadow: 0 0 10px #00ff4130;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .battle-interface {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      flex-wrap: wrap;
      justify-content: center;
    }

    .ship-command {
      background: linear-gradient(145deg, #001a00, #000a00);
      border: 2px solid #00ff41;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 20px #00ff4130;
      min-width: 250px;
    }

    .ship-command h3 {
      color: #00ff41;
      margin-bottom: 15px;
      text-align: center;
      font-size: 1.1em;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 0 0 8px #00ff41;
    }

    .fleet-roster {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 20px;
    }

    .ship-selector {
      background: linear-gradient(145deg, #002200, #001100);
      border: 1px solid #00ff41;
      border-radius: 6px;
      padding: 8px 12px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      font-weight: 700;
      color: #00ff41;
      position: relative;
      font-size: 0.9em;
      letter-spacing: 1px;
    }

    .ship-selector:hover {
      background: linear-gradient(145deg, #003300, #002200);
      box-shadow: 0 0 10px #00ff41;
      transform: translateY(-1px);
    }

    .ship-selector.selected {
      background: linear-gradient(145deg, #00ff41, #00cc33);
      color: #000;
      animation: radarPulse 1.5s infinite;
    }

    .ship-selector.deployed {
      background: linear-gradient(145deg, #004400, #002200);
      opacity: 0.7;
      cursor: not-allowed;
    }

    .ship-selector.deployed::after {
      content: "✓ DEPLOYED";
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      color: #00ff41;
      font-size: 0.8em;
      font-weight: 700;
    }

    @keyframes radarPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); box-shadow: 0 0 20px #00ff41; }
    }

    .command-controls {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .control-button {
      background: linear-gradient(145deg, #003300, #001800);
      color: #00ff41;
      border: 1px solid #00ff41;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.85em;
      font-weight: 700;
      font-family: 'Orbitron', monospace;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .control-button:hover {
      background: linear-gradient(145deg, #004400, #002200);
      box-shadow: 0 0 8px #00ff41;
    }

    .control-button:disabled {
      background: linear-gradient(145deg, #111, #080808);
      color: #666;
      border-color: #333;
      cursor: not-allowed;
      box-shadow: none;
    }

    .tactical-systems {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #00ff4150;
    }

    .tactical-button {
      background: linear-gradient(145deg, #440000, #220000);
      color: #ff4444;
      border: 1px solid #ff4444;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.8em;
      transition: all 0.3s;
      margin-bottom: 5px;
      width: 100%;
      font-family: 'Orbitron', monospace;
      font-weight: 700;
      text-transform: uppercase;
    }

    .tactical-button:hover:not(:disabled) {
      background: linear-gradient(145deg, #660000, #330000);
      box-shadow: 0 0 10px #ff444450;
    }

    .tactical-button:disabled {
      background: linear-gradient(145deg, #111, #080808);
      color: #666;
      border-color: #333;
      cursor: not-allowed;
    }

    .radar-screen {
      background: 
        radial-gradient(circle at center, #002200 0%, #001100 40%, #000800 100%),
        repeating-linear-gradient(0deg, transparent, transparent 31px, #00ff4108 32px),
        repeating-linear-gradient(90deg, transparent, transparent 31px, #00ff4108 32px);
      border: 3px solid #00ff41;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 
        0 0 30px #00ff4150,
        inset 0 0 30px #00110020;
      position: relative;
    }

    .radar-screen::before {
      content: '';
      position: absolute;
      top: -3px;
      left: -3px;
      right: -3px;
      bottom: -3px;
      background: linear-gradient(45deg, #00ff41, #00cc33, #00ff41);
      border-radius: 18px;
      z-index: -1;
      animation: borderGlow 3s ease-in-out infinite alternate;
    }

    @keyframes borderGlow {
      from { opacity: 0.5; }
      to { opacity: 1; }
    }

    .screen-title {
      font-size: 1.1em;
      font-weight: 700;
      color: #00ff41;
      text-align: center;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 0 0 8px #00ff41;
      background: linear-gradient(90deg, #001a00, #002200, #001a00);
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #00ff4150;
    }

    .grid-display {
      position: relative;
      display: inline-block;
    }

    .coordinate-labels {
      position: absolute;
      color: #00ff41;
      font-weight: 700;
      font-size: 11px;
      text-shadow: 0 0 3px #00ff41;
    }

    .coordinate-labels.letters {
      top: -18px;
      left: 20px;
      display: flex;
      width: 320px;
    }

    .coordinate-labels.numbers {
      left: -18px;
      top: 5px;
      display: flex;
      flex-direction: column;
      height: 320px;
    }

    .coordinate-labels span {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      font-weight: 700;
    }

    .radar-grid {
      display: grid;
      grid-template-columns: repeat(10, 32px);
      grid-template-rows: repeat(10, 32px);
      gap: 0;
      background: 
        linear-gradient(90deg, #00ff4105 0%, transparent 50%, #00ff4105 100%),
        linear-gradient(0deg, #00ff4105 0%, transparent 50%, #00ff4105 100%);
      border: 1px solid #00ff4150;
      box-shadow: inset 0 0 15px #00110020;
    }

    .radar-cell {
      width: 32px;
      height: 32px;
      background: linear-gradient(145deg, #001100, #000800);
      border: 1px solid #00ff4120;
      cursor: crosshair;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      position: relative;
      overflow: hidden;
    }

    .radar-cell::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at center, transparent 0%, #00ff4105 100%);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .radar-cell:hover::before {
      opacity: 1;
    }

    .radar-cell:hover {
      background: linear-gradient(145deg, #002200, #001100);
      border-color: #00ff41;
      box-shadow: 0 0 8px #00ff4150;
      transform: scale(1.05);
      z-index: 10;
    }

    .radar-cell.vessel {
      background: linear-gradient(145deg, #003300, #002200);
      border-color: #00ff41;
      box-shadow: inset 0 0 5px #00ff4150;
    }

    .radar-cell.vessel::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 4px;
      background: linear-gradient(90deg, #00ff41, #00cc33);
      border-radius: 2px;
      box-shadow: 0 0 5px #00ff41;
    }

    .radar-cell.impact {
      background: radial-gradient(circle, #ff4444, #cc0000);
      border-color: #ff4444;
      color: #fff;
      animation: impactFlash 0.6s ease-out;
      box-shadow: 0 0 15px #ff4444;
    }

    .radar-cell.miss {
      background: radial-gradient(circle, #4444ff, #0000cc);
      border-color: #4444ff;
      color: #fff;
      box-shadow: 0 0 8px #4444ff50;
    }

    .radar-cell.destroyed {
      background: radial-gradient(circle, #ff8800, #cc4400);
      border-color: #ff8800;
      color: #fff;
      animation: destroyedPulse 2s infinite;
      box-shadow: 0 0 12px #ff8800;
    }

    .radar-cell.target-lock {
      background: linear-gradient(145deg, #ffff00, #cccc00);
      border-color: #ffff00;
      animation: targetLock 1s infinite;
      z-index: 5;
    }

    .radar-cell.invalid-target {
      background: linear-gradient(145deg, #ff4444, #cc0000);
      border-color: #ff4444;
      animation: invalidFlash 0.5s ease-out;
    }

    @keyframes impactFlash {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); background: radial-gradient(circle, #fff, #ff4444); }
      100% { transform: scale(1); }
    }

    @keyframes destroyedPulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.1); }
    }

    @keyframes targetLock {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); box-shadow: 0 0 15px #ffff00; }
    }

    @keyframes invalidFlash {
      0% { background: linear-gradient(145deg, #ff4444, #cc0000); }
      50% { background: linear-gradient(145deg, #fff, #ff8888); }
      100% { background: linear-gradient(145deg, #ff4444, #cc0000); }
    }

    .mission-complete {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(0,0,0,0.9), rgba(0,0,0,0.95));
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .mission-report {
      background: linear-gradient(145deg, #001100, #000800);
      padding: 40px;
      border-radius: 15px;
      text-align: center;
      border: 3px solid #00ff41;
      box-shadow: 0 0 50px #00ff41;
      color: #00ff41;
      max-width: 600px;
    }

    .mission-report h2 {
      font-size: 2em;
      margin-bottom: 20px;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 3px;
      text-shadow: 0 0 15px #00ff41;
    }

    .mission-report button {
      background: linear-gradient(145deg, #00ff41, #00cc33);
      color: #000;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin: 0 10px;
      transition: all 0.3s;
      font-family: 'Orbitron', monospace;
      font-weight: 700;
      text-transform: uppercase;
    }

    .mission-report button:hover {
      background: linear-gradient(145deg, #00cc33, #009922);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px #00ff4150;
    }

    @media (max-width: 768px) {
      .battle-interface {
        flex-direction: column;
        align-items: center;
      }
      
      .radar-stats {
        flex-wrap: wrap;
        gap: 10px;
      }
      
      .radar-grid {
        grid-template-columns: repeat(10, 28px);
        grid-template-rows: repeat(10, 28px);
      }
      
      .radar-cell {
        width: 28px;
        height: 28px;
        font-size: 10px;
      }
      
      .coordinate-labels span {
        width: 28px;
        height: 28px;
      }

      .coordinate-labels.letters {
        width: 280px;
        left: 18px;
      }

      .coordinate-labels.numbers {
        height: 280px;
        left: -16px;
      }
    }
  </style>
</head>
<body>
  <div class="radar-container">
    <div class="command-header">
      <h1>⚡ NAVAL RADAR COMMAND ⚡</h1>
      
      <div class="status-bar">
        <div class="mode-selector" id="mode-selector">
          <button class="mode-btn active" data-mode="classic">Standard</button>
          <button class="mode-btn" data-mode="advanced">Enhanced</button>
        </div>
        
        <div class="radar-stats">
          <div class="stat-item">
            <div class="stat-value" id="player-score">000</div>
            <div>SCORE</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="shots-fired">000</div>
            <div>FIRED</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="hit-ratio">000%</div>
            <div>ACCURACY</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="ships-remaining">05</div>
            <div>TARGETS</div>
          </div>
        </div>
      </div>
    </div>

    <div class="status-message" id="status">
      AWAITING ORDERS - SELECT VESSELS FOR DEPLOYMENT
    </div>

    <div class="battle-interface">
      <div class="ship-command" id="ship-command">
        <h3>🚢 FLEET COMMAND</h3>
        <div class="fleet-roster">
          <div class="ship-selector" data-type="carrier" data-size="5" draggable="true">CARRIER [5]</div>
          <div class="ship-selector" data-type="battleship" data-size="4" draggable="true">BATTLESHIP [4]</div>
          <div class="ship-selector" data-type="cruiser" data-size="3" draggable="true">CRUISER [3]</div>
          <div class="ship-selector" data-type="submarine" data-size="3" draggable="true">SUBMARINE [3]</div>
          <div class="ship-selector" data-type="destroyer" data-size="2" draggable="true">DESTROYER [2]</div>
        </div>
        
        <div class="command-controls">
          <button class="control-button" id="rotate-btn">↻ ROTATE</button>
          <button class="control-button" id="random-btn">⚡ AUTO DEPLOY</button>
          <button class="control-button" id="clear-btn">⌫ CLEAR ALL</button>
          <button class="control-button" id="start-btn" disabled>▶ ENGAGE</button>
        </div>

        <div class="tactical-systems" id="tactical-systems" style="display: none;">
          <button class="tactical-button" id="sonar-btn" disabled>📡 SONAR [200]</button>
          <button class="tactical-button" id="airstrike-btn" disabled">✈ AIRSTRIKE [100]</button>
        </div>
      </div>

      <div class="radar-screen">
        <div class="screen-title">🏠 HOME SECTOR</div>
        <div class="grid-display">
          <div class="coordinate-labels letters">
            <span>A</span><span>B</span><span>C</span><span>D</span><span>E</span>
            <span>F</span><span>G</span><span>H</span><span>I</span><span>J</span>
          </div>
          <div class="coordinate-labels numbers">
            <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
            <span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
          </div>
          <div class="radar-grid" id="player-grid"></div>
        </div>
      </div>

      <div class="radar-screen">
        <div class="screen-title">🎯 ENEMY SECTOR</div>
        <div class="grid-display">
          <div class="coordinate-labels letters">
            <span>A</span><span>B</span><span>C</span><span>D</span><span>E</span>
            <span>F</span><span>G</span><span>H</span><span>I</span><span>J</span>
          </div>
          <div class="coordinate-labels numbers">
            <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
            <span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
          </div>
          <div class="radar-grid" id="enemy-grid"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Game state
    let gameMode = 'classic';
    let gamePhase = 'setup';
    let playerGrid = Array(10).fill().map(() => Array(10).fill(null));
    let enemyGrid = Array(10).fill().map(() => Array(10).fill(null));
    let playerShips = [];
    let enemyShips = [];
    let selectedShip = null;
    let orientation = 'horizontal';
    let playerTurn = true;
    let gameOver = false;
    let gameStats = {
      score: 0,
      shotsFired: 0,
      hits: 0,
      enemyShipsRemaining: 5
    };

    const SHIPS = [
      { type: 'carrier', size: 5, name: 'Aircraft Carrier' },
      { type: 'battleship', size: 4, name: 'Battleship' },
      { type: 'cruiser', size: 3, name: 'Cruiser' },
      { type: 'submarine', size: 3, name: 'Submarine' },
      { type: 'destroyer', size: 2, name: 'Destroyer' }
    ];

    // Initialize game
    function initGame() {
      createGrids();
      setupEventListeners();
      updateStatus('Select your ships and deploy them on your grid, Admiral!');
    }

    // Create grid displays
    function createGrids() {
      createGrid('player-grid', 'player');
      createGrid('enemy-grid', 'enemy');
    }

    function createGrid(containerId, gridType) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      
      for (let row = 0; row < 10; row++) {
        for (let col = 0; col < 10; col++) {
          const cell = document.createElement('div');
          cell.className = 'radar-cell';
          cell.dataset.row = row;
          cell.dataset.col = col;
          cell.dataset.grid = gridType;
          
          if (gridType === 'player') {
            cell.addEventListener('click', () => handlePlayerGridClick(row, col));
            cell.addEventListener('mouseenter', () => showPlacementPreview(row, col));
            cell.addEventListener('mouseleave', () => clearPlacementPreview());
            // Drag-and-drop events
            cell.addEventListener('dragover', handleCellDragOver);
            cell.addEventListener('dragleave', handleCellDragLeave);
            cell.addEventListener('drop', handleCellDrop);
          } else if (gridType === 'enemy' && gamePhase === 'playing') {
            cell.addEventListener('click', () => handleEnemyGridClick(row, col));
          }
          
          container.appendChild(cell);
        }
      }
    }

    // Setup event listeners
    function setupEventListeners() {
      // Mode selection
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.addEventListener('click', () => selectGameMode(btn.dataset.mode));
      });

      // Ship selection (click)
      document.querySelectorAll('.ship-selector').forEach(ship => {
        ship.addEventListener('click', () => selectShip(ship));
        // Drag-and-drop events for ships
        ship.addEventListener('dragstart', handleShipDragStart);
        ship.addEventListener('dragend', handleShipDragEnd);
      });

      // Control buttons
      document.getElementById('rotate-btn').addEventListener('click', rotateShip);
      document.getElementById('random-btn').addEventListener('click', randomPlacement);
      document.getElementById('clear-btn').addEventListener('click', clearAllShips);
      document.getElementById('start-btn').addEventListener('click', startGame);

      // Powerups
      document.getElementById('sonar-btn').addEventListener('click', useSonar);
      document.getElementById('airstrike-btn').addEventListener('click', useAirstrike);

      // Drag-and-drop events for player grid cells
      document.querySelectorAll('[data-grid="player"] .radar-cell').forEach(cell => {
        cell.addEventListener('dragover', handleCellDragOver);
        cell.addEventListener('dragleave', handleCellDragLeave);
        cell.addEventListener('drop', handleCellDrop);
      });
    }

    // Game mode selection
    function selectGameMode(mode) {
      gameMode = mode;
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.mode === mode);
      });
      
      const powerupsDiv = document.getElementById('tactical-systems');
      powerupsDiv.style.display = mode === 'advanced' ? 'block' : 'none';
      
      updateStatus(mode === 'classic' 
        ? 'Classic Mode: Traditional naval warfare!' 
        : 'Advanced Mode: Strategic warfare with tactical support!');
    }

    // Ship selection
    function selectShip(shipElement) {
      if (shipElement.classList.contains('deployed')) return;
      
      document.querySelectorAll('.ship-selector').forEach(s => s.classList.remove('selected'));
      shipElement.classList.add('selected');
      
      const shipType = shipElement.dataset.type;
      selectedShip = SHIPS.find(s => s.type === shipType);
      updateStatus(`${selectedShip.name} selected! Click on your grid to deploy (${orientation}).`);
    }

    // Show placement preview
    function showPlacementPreview(row, col) {
      if (!selectedShip || gamePhase !== 'setup') return;
      
      clearPlacementPreview();
      
      const canPlace = canPlaceShip(playerGrid, row, col, selectedShip.size, orientation);
      
      for (let i = 0; i < selectedShip.size; i++) {
        const targetRow = row + (orientation === 'vertical' ? i : 0);
        const targetCol = col + (orientation === 'horizontal' ? i : 0);
        
        if (targetRow < 10 && targetCol < 10) {
          const cell = document.querySelector(`[data-grid="player"][data-row="${targetRow}"][data-col="${targetCol}"]`);
          if (cell) {
            if (canPlace) {
              cell.classList.add('selected');
            } else {
              cell.classList.add('invalid-target');
            }
          }
        }
      }
    }

    function clearPlacementPreview() {
      document.querySelectorAll('[data-grid="player"] .radar-cell').forEach(cell => {
        cell.classList.remove('selected', 'invalid-target');
      });
    }

    // Check if ship can be placed
    function canPlaceShip(grid, row, col, size, orientation) {
      for (let i = 0; i < size; i++) {
        const targetRow = row + (orientation === 'vertical' ? i : 0);
        const targetCol = col + (orientation === 'horizontal' ? i : 0);
        
        if (targetRow >= 10 || targetCol >= 10 || grid[targetRow][targetCol]) {
          return false;
        }
      }
      return true;
    }

    // Handle player grid click (ship placement)
    function handlePlayerGridClick(row, col) {
      if (!selectedShip || gamePhase !== 'setup') return;
      
      if (!canPlaceShip(playerGrid, row, col, selectedShip.size, orientation)) {
        updateStatus('Cannot deploy there, Admiral! Choose different coordinates.');
        return;
      }
      
      placeShip(row, col);
    }

    // Place ship on grid
    function placeShip(row, col) {
      const shipCells = [];
      
      for (let i = 0; i < selectedShip.size; i++) {
        const targetRow = row + (orientation === 'vertical' ? i : 0);
        const targetCol = col + (orientation === 'horizontal' ? i : 0);
        
        playerGrid[targetRow][targetCol] = selectedShip.type;
        shipCells.push({ row: targetRow, col: targetCol });
      }
      
      playerShips.push({
        ...selectedShip,
        cells: shipCells,
        hits: 0,
        sunk: false
      });
      
      // Mark ship as placed
      document.querySelector(`[data-type="${selectedShip.type}"]`).classList.add('deployed');
      selectedShip = null;
      
      updatePlayerGrid();
      clearPlacementPreview();
      
      if (playerShips.length === 5) {
        document.getElementById('start-btn').disabled = false;
        updateStatus('Fleet deployed! All ships ready for battle, Admiral!');
      } else {
        updateStatus(`Ship deployed! Select next vessel to deploy.`);
      }
    }

    // Update grid displays
    function updatePlayerGrid() {
      for (let row = 0; row < 10; row++) {
        for (let col = 0; col < 10; col++) {
          const cell = document.querySelector(`[data-grid="player"][data-row="${row}"][data-col="${col}"]`);
          const cellValue = playerGrid[row][col];
          
          cell.className = 'radar-cell';
          if (cellValue && cellValue !== 'hit' && cellValue !== 'miss') {
            cell.classList.add('vessel');
          } else if (cellValue === 'hit') {
            cell.classList.add('impact');
            cell.textContent = '💥';
          } else if (cellValue === 'miss') {
            cell.classList.add('miss');
            cell.textContent = '💧';
          }
        }
      }
    }

    function updateEnemyGrid() {
      for (let row = 0; row < 10; row++) {
        for (let col = 0; col < 10; col++) {
          const cell = document.querySelector(`[data-grid="enemy"][data-row="${row}"][data-col="${col}"]`);
          const cellValue = enemyGrid[row][col];
          
          cell.className = 'radar-cell';
          if (cellValue === 'hit') {
            cell.classList.add('impact');
            cell.textContent = '💥';
          } else if (cellValue === 'miss') {
            cell.classList.add('miss');
            cell.textContent = '💧';
          }
          
          // Check if part of sunk ship
          const sunkShip = enemyShips.find(ship => 
            ship.sunk && ship.cells.some(c => c.row === row && c.col === col)
          );
          if (sunkShip) {
            cell.classList.add('destroyed');
            cell.textContent = '🔥';
          }
        }
      }
    }

    // Control functions
    function rotateShip() {
      orientation = orientation === 'horizontal' ? 'vertical' : 'horizontal';
      updateStatus(`Ship orientation: ${orientation.toUpperCase()}`);
    }

    function randomPlacement() {
      clearAllShips();
      
      SHIPS.forEach(ship => {
        let placed = false;
        let attempts = 0;
        
        while (!placed && attempts < 100) {
          const row = Math.floor(Math.random() * 10);
          const col = Math.floor(Math.random() * 10);
          const orient = Math.random() > 0.5 ? 'horizontal' : 'vertical';
          
          if (canPlaceShip(playerGrid, row, col, ship.size, orient)) {
            const shipCells = [];
            
            for (let i = 0; i < ship.size; i++) {
              const targetRow = row + (orient === 'vertical' ? i : 0);
              const targetCol = col + (orient === 'horizontal' ? i : 0);
              
              playerGrid[targetRow][targetCol] = ship.type;
              shipCells.push({ row: targetRow, col: targetCol });
            }
            
            playerShips.push({
              ...ship,
              cells: shipCells,
              hits: 0,
              sunk: false
            });
            
            document.querySelector(`[data-type="${ship.type}"]`).classList.add('deployed');
            placed = true;
          }
          attempts++;
        }
      });
      
      updatePlayerGrid();
      document.getElementById('start-btn').disabled = false;
      updateStatus('Fleet auto-deployed! All ships battle-ready, Admiral!');
    }

    function clearAllShips() {
      playerGrid = Array(10).fill().map(() => Array(10).fill(null));
      playerShips = [];
      selectedShip = null;
      
      document.querySelectorAll('.ship-selector').forEach(ship => {
        ship.classList.remove('deployed', 'selected');
      });
      
      document.getElementById('start-btn').disabled = true;
      updatePlayerGrid();
      updateStatus('Fleet cleared. Redeploy your ships for battle.');
    }

    // Start game
    function startGame() {
      if (playerShips.length !== 5) {
        updateStatus('Deploy all ships before battle, Admiral!');
        return;
      }
      
      gamePhase = 'playing';
      document.getElementById('ship-command').style.display = 'none';
      
      // Place enemy ships
      placeEnemyShips();
      
      // Update enemy grid event listeners
      createGrid('enemy-grid', 'enemy');
      document.querySelectorAll('[data-grid="enemy"] .radar-cell').forEach(cell => {
        cell.addEventListener('click', () => {
          const row = parseInt(cell.dataset.row);
          const col = parseInt(cell.dataset.col);
          handleEnemyGridClick(row, col);
        });
      });
      
      updateStatus('⚔️ BATTLE COMMENCED! Target enemy waters and fire, Admiral!');
      updateStats();
    }

    // Place enemy ships randomly
    function placeEnemyShips() {
      enemyGrid = Array(10).fill().map(() => Array(10).fill(null));
      enemyShips = [];
      
      SHIPS.forEach(ship => {
        let placed = false;
        let attempts = 0;
        
        while (!placed && attempts < 100) {
          const row = Math.floor(Math.random() * 10);
          const col = Math.floor(Math.random() * 10);
          const orient = Math.random() > 0.5 ? 'horizontal' : 'vertical';
          
          if (canPlaceShip(enemyGrid, row, col, ship.size, orient)) {
            const shipCells = [];
            
            for (let i = 0; i < ship.size; i++) {
              const targetRow = row + (orient === 'vertical' ? i : 0);
              const targetCol = col + (orient === 'horizontal' ? i : 0);
              
              enemyGrid[targetRow][targetCol] = ship.type;
              shipCells.push({ row: targetRow, col: targetCol });
            }
            
            enemyShips.push({
              ...ship,
              cells: shipCells,
              hits: 0,
              sunk: false
            });
            
            placed = true;
          }
          attempts++;
        }
      });
    }

    // Handle enemy grid attack
    function handleEnemyGridClick(row, col) {
      if (!playerTurn || gamePhase !== 'playing' || gameOver) return;
      
      const cellValue = enemyGrid[row][col];
      
      if (cellValue === 'hit' || cellValue === 'miss') {
        updateStatus('Already targeted those coordinates, Admiral!');
        return;
      }
      
      gameStats.shotsFired++;
      
      if (cellValue && cellValue !== 'hit' && cellValue !== 'miss') {
        // Direct hit!
        enemyGrid[row][col] = 'hit';
        gameStats.hits++;
        gameStats.score += 10;
        
        const hitShip = enemyShips.find(ship => ship.type === cellValue);
        hitShip.hits++;
        
        if (hitShip.hits === hitShip.size) {
          hitShip.sunk = true;
          gameStats.enemyShipsRemaining--;
          gameStats.score += hitShip.size * 20;
          updateStatus(`🎯 DIRECT HIT! Enemy ${hitShip.name} DESTROYED! Continue firing!`);
          
          if (gameStats.enemyShipsRemaining === 0) {
            endGame(true);
            return;
          }
        } else {
          updateStatus('🎯 DIRECT HIT! Enemy vessel damaged! Fire again!');
        }
        
        // Player continues turn after hit
      } else {
        // Miss
        enemyGrid[row][col] = 'miss';
        updateStatus('💧 MISS! Enemy taking evasive action...');
        playerTurn = false;
        
        setTimeout(() => {
          enemyAttack();
        }, 1500);
      }
      
      updateEnemyGrid();
      updateStats();
      updatePowerups();
    }

    // Enemy AI attack
    function enemyAttack() {
      if (playerTurn || gamePhase !== 'playing' || gameOver) return;
      
      let row, col;
      let attempts = 0;
      
      // Simple AI: random attacks
      do {
        row = Math.floor(Math.random() * 10);
        col = Math.floor(Math.random() * 10);
        attempts++;
      } while ((playerGrid[row][col] === 'hit' || playerGrid[row][col] === 'miss') && attempts < 100);
      
      const cellValue = playerGrid[row][col];
      const coords = String.fromCharCode(65 + col) + (row + 1);
      
      if (cellValue && cellValue !== 'hit' && cellValue !== 'miss') {
        // Enemy hit
        playerGrid[row][col] = 'hit';
        
        const hitShip = playerShips.find(ship => ship.type === cellValue);
        hitShip.hits++;
        
        if (hitShip.hits === hitShip.size) {
          hitShip.sunk = true;
          updateStatus(`💀 MAYDAY! Enemy destroyed our ${hitShip.name} at ${coords}!`);
          
          const playerShipsRemaining = playerShips.filter(ship => !ship.sunk).length;
          if (playerShipsRemaining === 0) {
            endGame(false);
            return;
          }
        } else {
          updateStatus(`💀 INCOMING! Enemy hit our ${hitShip.name} at ${coords}!`);
        }
        
        // Enemy continues after hit
        setTimeout(() => {
          enemyAttack();
        }, 1000);
      } else {
        // Enemy miss
        playerGrid[row][col] = 'miss';
        updateStatus(`💧 Enemy missed at ${coords}! Return fire, Admiral!`);
        playerTurn = true;
      }
      
      updatePlayerGrid();
    }

    // Powerups (Advanced mode)
    function useSonar() {
      if (gameStats.score < 200) return;
      
      gameStats.score -= 200;
      
      // Reveal a random enemy ship position
      const unrevealedShips = enemyShips.filter(ship => !ship.sunk);
      if (unrevealedShips.length > 0) {
        const randomShip = unrevealedShips[Math.floor(Math.random() * unrevealedShips.length)];
        const randomCell = randomShip.cells[Math.floor(Math.random() * randomShip.cells.length)];
        
        // Highlight the revealed cell temporarily
        const cell = document.querySelector(`[data-grid="enemy"][data-row="${randomCell.row}"][data-col="${randomCell.col}"]`);
        const originalBg = cell.style.background;
        const originalBorder = cell.style.border;
        
        cell.style.background = 'linear-gradient(145deg, #fbb040, #ed8936)';
        cell.style.border = '3px solid #dd6b20';
        cell.textContent = '📡';
        
        setTimeout(() => {
          cell.style.background = originalBg;
          cell.style.border = originalBorder;
          cell.textContent = '';
        }, 3000);
        
        const coords = String.fromCharCode(65 + randomCell.col) + (randomCell.row + 1);
        updateStatus(`📡 SONAR CONTACT! Enemy vessel detected at ${coords}!`);
        updateStats();
        updatePowerups();
      }
    }

    function useAirstrike() {
      if (gameStats.score < 100) return;
      
      gameStats.score -= 100;
      
      // Attack 5 random cells
      let strikes = 0;
      const maxStrikes = 5;
      let hitResults = [];
      
      while (strikes < maxStrikes) {
        const row = Math.floor(Math.random() * 10);
        const col = Math.floor(Math.random() * 10);
        
        if (enemyGrid[row][col] !== 'hit' && enemyGrid[row][col] !== 'miss') {
          const cellValue = enemyGrid[row][col];
          const coords = String.fromCharCode(65 + col) + (row + 1);
          
          if (cellValue && cellValue !== 'hit' && cellValue !== 'miss') {
            // Hit!
            enemyGrid[row][col] = 'hit';
            gameStats.hits++;
            gameStats.score += 5;
            
            const hitShip = enemyShips.find(ship => ship.type === cellValue);
            hitShip.hits++;
            
            if (hitShip.hits === hitShip.size) {
              hitShip.sunk = true;
              gameStats.enemyShipsRemaining--;
              gameStats.score += hitShip.size * 10;
              hitResults.push(`${coords} - ${hitShip.name} DESTROYED`);
            } else {
              hitResults.push(`${coords} - HIT`);
            }
          } else {
            // Miss
            enemyGrid[row][col] = 'miss';
            hitResults.push(`${coords} - MISS`);
          }
          
          strikes++;
        }
      }
      
      updateEnemyGrid();
      updateStatus(`✈️ AIR STRIKE COMPLETE! Results: ${hitResults.join(', ')}`);
      updateStats();
      updatePowerups();
      
      if (gameStats.enemyShipsRemaining === 0) {
        endGame(true);
      }
    }

    // Update statistics display
    function updateStats() {
      document.getElementById('player-score').textContent = gameStats.score;
      document.getElementById('shots-fired').textContent = gameStats.shotsFired;
      document.getElementById('hit-ratio').textContent = 
        gameStats.shotsFired > 0 ? Math.round((gameStats.hits / gameStats.shotsFired) * 100) + '%' : '0%';
      document.getElementById('ships-remaining').textContent = gameStats.enemyShipsRemaining;
    }

    // Update powerup button states
    function updatePowerups() {
      if (gameMode === 'advanced') {
        const sonarBtn = document.getElementById('sonar-btn');
        const airstrikeBtn = document.getElementById('airstrike-btn');
        
        sonarBtn.disabled = gameStats.score < 200;
        airstrikeBtn.disabled = gameStats.score < 100;
        
        sonarBtn.textContent = gameStats.score >= 200 ? '📡 SONAR [200] - READY' : `📡 SONAR [${200 - gameStats.score} pts needed]`;
        airstrikeBtn.textContent = gameStats.score >= 100 ? '✈ AIRSTRIKE [100] - READY' : `✈ AIRSTRIKE [${100 - gameStats.score} pts needed]`;
      }
    }

    // End game
    function endGame(playerWon) {
      gamePhase = 'ended';
      gameOver = true;
      
      const modal = document.createElement('div');
      modal.className = 'mission-complete';
      
      const finalScore = gameStats.score;
      const accuracy = gameStats.shotsFired > 0 ? Math.round((gameStats.hits / gameStats.shotsFired) * 100) : 0;
      
      modal.innerHTML = `
        <div class="mission-report">
          <h2>${playerWon ? '🎉 MISSION COMPLETE! 🎉' : '💀 MISSION FAILED 💀'}</h2>
          <p><strong>${playerWon ? 'Outstanding work, Admiral! Enemy fleet completely destroyed!' : 'Enemy has sunk our entire fleet! Better luck next time, Admiral.'}</strong></p>
          <div style="margin: 20px 0; text-align: left;">
            <div><strong>Final Score:</strong> ${finalScore} points</div>
            <div><strong>Shots Fired:</strong> ${gameStats.shotsFired}</div>
            <div><strong>Hit Accuracy:</strong> ${accuracy}%</div>
            <div><strong>Game Mode:</strong> ${gameMode.charAt(0).toUpperCase() + gameMode.slice(1)}</div>
          </div>
          <button onclick="location.reload()">🔄 New Battle</button>
          <button onclick="document.querySelector('.mission-complete').remove()">📊 Review Battle</button>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    // Update status message
    function updateStatus(message) {
      document.getElementById('status').textContent = message;
    }

    // Drag-and-drop handlers for ships
    let draggedShip = null;
    function handleShipDragStart(e) {
      if (this.classList.contains('deployed')) {
        e.preventDefault();
        return;
      }
      draggedShip = SHIPS.find(s => s.type === this.dataset.type);
      // Store ship type and orientation in dataTransfer
      e.dataTransfer.setData('text/plain', JSON.stringify({
        type: draggedShip.type,
        size: draggedShip.size,
        orientation: orientation
      }));
      // Optional: highlight possible drop targets
    }
    function handleShipDragEnd(e) {
      draggedShip = null;
      clearPlacementPreview();
    }

    // Drag-and-drop handlers for grid cells
    function handleCellDragOver(e) {
      e.preventDefault(); // Allow drop
      if (!draggedShip || gamePhase !== 'setup') return;
      const row = parseInt(this.dataset.row);
      const col = parseInt(this.dataset.col);
      const canDeploy = canPlaceShip(playerGrid, row, col, draggedShip.size, orientation);
      // Show preview for dragged ship
      selectedShip = draggedShip;
      showPlacementPreview(row, col);
      // No need to add extra classes here; showPlacementPreview handles visual feedback
    }
    function handleCellDragLeave(e) {
      clearPlacementPreview();
    }
    function handleCellDrop(e) {
      e.preventDefault();
      if (!draggedShip || gamePhase !== 'setup') return;
      const row = parseInt(this.dataset.row);
      const col = parseInt(this.dataset.col);
      if (!canPlaceShip(playerGrid, row, col, draggedShip.size, orientation)) {
        updateStatus('DEPLOYMENT BLOCKED - SELECT ALTERNATIVE COORDINATES');
        clearPlacementPreview();
        return;
      }
      // Place the ship
      selectedShip = draggedShip;
      placeShip(row, col);
      draggedShip = null;
      clearPlacementPreview();
    }

    // Initialize game when page loads
    document.addEventListener('DOMContentLoaded', () => {
      initGame();
    });
  </script>
</body>
</html>
