<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Battleship Game</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #8B4513 0%, #A0522D 50%, #CD853F 100%);
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      background-image: 
        radial-gradient(circle at 20% 20%, rgba(139, 69, 19, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(160, 82, 45, 0.3) 0%, transparent 50%);
    }

    .game-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .game-header h1 {
      font-size: 2.5em;
      color: #1e3a5f;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      margin-bottom: 10px;
      font-weight: bold;
      letter-spacing: 2px;
    }

    .game-mode-selector {
      margin-bottom: 20px;
    }

    .mode-btn {
      background: linear-gradient(145deg, #2c5282, #2a4b7a);
      color: white;
      border: 2px solid #1a365d;
      padding: 12px 24px;
      margin: 0 10px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .mode-btn:hover {
      background: linear-gradient(145deg, #3182ce, #2c5282);
      transform: translateY(-2px);
    }

    .mode-btn.active {
      background: linear-gradient(145deg, #e53e3e, #c53030);
      border-color: #9b2c2c;
    }

    .game-stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .stat-box {
      background: linear-gradient(145deg, #f7fafc, #e2e8f0);
      border: 2px solid #a0aec0;
      border-radius: 10px;
      padding: 12px 20px;
      text-align: center;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
      min-width: 120px;
    }

    .stat-value {
      font-size: 1.4em;
      font-weight: bold;
      color: #2d3748;
    }

    .stat-label {
      font-size: 0.9em;
      color: #4a5568;
      margin-top: 4px;
    }

    .status-message {
      background: linear-gradient(145deg, #2d3748, #1a202c);
      color: #f7fafc;
      padding: 12px 24px;
      border-radius: 25px;
      font-size: 1.1em;
      font-weight: bold;
      text-align: center;
      margin: 10px 0;
      border: 2px solid #4a5568;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .battleship-container {
      display: flex;
      gap: 30px;
      align-items: flex-start;
      flex-wrap: wrap;
      justify-content: center;
    }

    .ship-dock {
      background: linear-gradient(145deg, #2d3748, #1a202c);
      border: 3px solid #4a5568;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      min-width: 220px;
    }

    .ship-dock h3 {
      color: #f7fafc;
      margin-bottom: 15px;
      text-align: center;
      font-size: 1.2em;
    }

    .ship-fleet {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }

    .ship-item {
      background: linear-gradient(145deg, #3182ce, #2c5282);
      border: 2px solid #2a4b7a;
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      font-weight: bold;
      color: white;
      position: relative;
    }

    .ship-item:hover {
      background: linear-gradient(145deg, #2b6cb0, #2553a0);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .ship-item.selected {
      background: linear-gradient(145deg, #ed8936, #dd6b20);
      border-color: #c05621;
      animation: pulse 1.5s infinite;
    }

    .ship-item.placed {
      background: linear-gradient(145deg, #38a169, #2f855a);
      border-color: #276749;
      opacity: 0.7;
      cursor: not-allowed;
    }

    .ship-item.placed::after {
      content: "‚úì";
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      color: #f0fff4;
      font-weight: bold;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .control-btn {
      background: linear-gradient(145deg, #805ad5, #6b46c1);
      color: white;
      border: 2px solid #553c9a;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 13px;
      font-weight: bold;
    }

    .control-btn:hover {
      background: linear-gradient(145deg, #7c3aed, #6b46c1);
      transform: translateY(-1px);
    }

    .control-btn:disabled {
      background: linear-gradient(145deg, #a0aec0, #718096);
      border-color: #4a5568;
      cursor: not-allowed;
      transform: none;
    }

    .powerups {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #4a5568;
    }

    .powerup-btn {
      background: linear-gradient(145deg, #e53e3e, #c53030);
      color: white;
      border: 2px solid #9b2c2c;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.3s;
      margin-bottom: 6px;
      width: 100%;
    }

    .powerup-btn:hover {
      background: linear-gradient(145deg, #dc2626, #b91c1c);
    }

    .powerup-btn:disabled {
      background: linear-gradient(145deg, #a0aec0, #718096);
      border-color: #4a5568;
      cursor: not-allowed;
    }

    .board-container {
      background: linear-gradient(145deg, #1a365d, #2c5282);
      border: 4px solid #2a4b7a;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 12px 24px rgba(0,0,0,0.4);
      position: relative;
    }

    .board-container::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(145deg, #4a5568, #2d3748);
      border-radius: 17px;
      z-index: -1;
    }

    .board-title {
      font-size: 1.3em;
      font-weight: bold;
      color: #f7fafc;
      text-align: center;
      margin-bottom: 15px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
      background: linear-gradient(145deg, #2d3748, #1a202c);
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid #4a5568;
    }

    .grid-container {
      position: relative;
      display: inline-block;
    }

    .grid-labels {
      position: absolute;
      color: #f7fafc;
      font-weight: bold;
      font-size: 12px;
    }

    .grid-labels.letters {
      top: -20px;
      left: 25px;
      display: flex;
      width: 320px;
    }

    .grid-labels.numbers {
      left: -20px;
      top: 5px;
      display: flex;
      flex-direction: column;
      height: 320px;
    }

    .grid-labels span {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(10, 32px);
      grid-template-rows: repeat(10, 32px);
      gap: 0;
      background: #2d3748;
      border: 2px solid #4a5568;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
    }

    .cell {
      width: 32px;
      height: 32px;
      background: linear-gradient(145deg, #4299e1, #3182ce);
      border: 1px solid #2b6cb0;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      position: relative;
    }

    .cell:hover {
      background: linear-gradient(145deg, #63b3ed, #4299e1);
      transform: scale(1.05);
      z-index: 10;
    }

    .cell.ship {
      background: linear-gradient(145deg, #4a5568, #2d3748);
      border-color: #1a202c;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
    }

    .cell.ship::before {
      content: '';
      position: absolute;
      width: 20px;
      height: 6px;
      background: linear-gradient(145deg, #718096, #4a5568);
      border-radius: 3px;
      border: 1px solid #2d3748;
    }

    .cell.hit {
      background: radial-gradient(circle, #fc8181, #e53e3e);
      border-color: #c53030;
      color: white;
      animation: hitFlash 0.5s ease-out;
    }

    .cell.miss {
      background: radial-gradient(circle, #a0aec0, #718096);
      border-color: #4a5568;
      color: white;
    }

    .cell.sunk {
      background: radial-gradient(circle, #2d3748, #1a202c);
      border-color: #000;
      color: #e53e3e;
      animation: sunkPulse 2s infinite;
    }

    .cell.selected {
      background: linear-gradient(145deg, #fbb040, #ed8936);
      border-color: #dd6b20;
      animation: selectPulse 1s infinite;
      z-index: 5;
    }

    .cell.invalid {
      background: linear-gradient(145deg, #fc8181, #e53e3e);
      border-color: #c53030;
    }

    @keyframes hitFlash {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); background: radial-gradient(circle, #fff, #fc8181); }
      100% { transform: scale(1); }
    }

    @keyframes sunkPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    @keyframes selectPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .game-over-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-content {
      background: linear-gradient(145deg, #f7fafc, #e2e8f0);
      padding: 40px;
      border-radius: 20px;
      text-align: center;
      border: 4px solid #2d3748;
      box-shadow: 0 20px 40px rgba(0,0,0,0.5);
      color: #2d3748;
    }

    .modal-content h2 {
      font-size: 2em;
      margin-bottom: 20px;
      color: #1a365d;
    }

    .modal-content button {
      background: linear-gradient(145deg, #3182ce, #2c5282);
      color: white;
      border: 2px solid #2a4b7a;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin: 0 10px;
      transition: all 0.3s;
    }

    .modal-content button:hover {
      background: linear-gradient(145deg, #2b6cb0, #2553a0);
      transform: translateY(-2px);
    }

    @media (max-width: 768px) {
      .battleship-container {
        flex-direction: column;
        align-items: center;
      }
      
      .game-stats {
        justify-content: center;
        gap: 10px;
      }
      
      .stat-box {
        min-width: 80px;
        padding: 8px 12px;
      }
      
      .grid {
        grid-template-columns: repeat(10, 28px);
        grid-template-rows: repeat(10, 28px);
      }
      
      .cell {
        width: 28px;
        height: 28px;
        font-size: 12px;
      }
      
      .grid-labels span {
        width: 28px;
        height: 28px;
      }

      .grid-labels.letters {
        width: 280px;
        left: 20px;
      }

      .grid-labels.numbers {
        height: 280px;
      }
    }
  </style>
</head>
<body>
  <div class="game-header">
    <h1>‚öì BATTLESHIP ‚öì</h1>
    <div class="game-mode-selector" id="mode-selector">
      <button class="mode-btn active" data-mode="classic">Classic Mode</button>
      <button class="mode-btn" data-mode="advanced">Advanced Mode</button>
    </div>
  </div>
  <div class="game-stats">
    <div class="stat-box">
      <div class="stat-value" id="player-score">0</div>
      <div class="stat-label">Your Score</div>
    </div>
    <div class="stat-box">
      <div class="stat-value" id="shots-fired">0</div>
      <div class="stat-label">Shots Fired</div>
    </div>
    <div class="stat-box">
      <div class="stat-value" id="hit-ratio">0%</div>
      <div class="stat-label">Hit Ratio</div>
    </div>
    <div class="stat-box">
      <div class="stat-value" id="ships-remaining">5</div>
      <div class="stat-label">Enemy Ships</div>
    </div>
  </div>
  <div class="status-message" id="status">
    Welcome Admiral! Select your game mode and deploy your fleet.
  </div>
  <div class="battleship-container">
    <div class="ship-dock" id="ship-dock">
      <h3>üö¢ Fleet Command</h3>
      <div class="ship-fleet">
        <div class="ship-item" data-type="carrier" data-size="5" draggable="true">‚öì Aircraft Carrier (5)</div>
        <div class="ship-item" data-type="battleship" data-size="4" draggable="true">üö¢ Battleship (4)</div>
        <div class="ship-item" data-type="cruiser" data-size="3" draggable="true">‚õµ Cruiser (3)</div>
        <div class="ship-item" data-type="submarine" data-size="3" draggable="true">üö§ Submarine (3)</div>
        <div class="ship-item" data-type="destroyer" data-size="2" draggable="true">üõ•Ô∏è Destroyer (2)</div>
      </div>
      <div class="controls">
        <button class="control-btn" id="rotate-btn">üîÑ Rotate Ship</button>
        <button class="control-btn" id="random-btn">üé≤ Auto Deploy</button>
        <button class="control-btn" id="clear-btn">üóëÔ∏è Clear Fleet</button>
        <button class="control-btn" id="start-btn" disabled>‚öîÔ∏è Begin Battle!</button>
      </div>
      <div class="powerups" id="powerups" style="display: none;">
        <button class="powerup-btn" id="sonar-btn" disabled>üì° Sonar Scan (200pts)</button>
        <button class="powerup-btn" id="airstrike-btn" disabled>‚úàÔ∏è Air Strike (100pts)</button>
      </div>
    </div>
    <div class="board-container">
      <div class="board-title">üè† Home Fleet</div>
      <div class="grid-container">
        <div class="grid-labels letters">
          <span>A</span><span>B</span><span>C</span><span>D</span><span>E</span>
          <span>F</span><span>G</span><span>H</span><span>I</span><span>J</span>
        </div>
        <div class="grid-labels numbers">
          <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
          <span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
        </div>
        <div class="grid" id="player-grid"></div>
      </div>
    </div>
    <div class="board-container">
      <div class="board-title">üéØ Enemy Waters</div>
      <div class="grid-container">
        <div class="grid-labels letters">
          <span>A</span><span>B</span><span>C</span><span>D</span><span>E</span>
          <span>F</span><span>G</span><span>H</span><span>I</span><span>J</span>
        </div>
        <div class="grid-labels numbers">
          <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
          <span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
        </div>
        <div class="grid" id="enemy-grid"></div>
      </div>
    </div>
  </div>
  <script>
    // Game state
    let gameMode = 'classic';
    let gamePhase = 'setup';
    let playerGrid = Array(10).fill().map(() => Array(10).fill(null));
    let enemyGrid = Array(10).fill().map(() => Array(10).fill(null));
    let playerShips = [];
    let enemyShips = [];
    let selectedShip = null;
    let orientation = 'horizontal';
    let playerTurn = true;
    let gameOver = false;
    let gameStats = {
      score: 0,
      shotsFired: 0,
      hits: 0,
      enemyShipsRemaining: 5
    };

    const SHIPS = [
      { type: 'carrier', size: 5, name: 'Aircraft Carrier' },
      { type: 'battleship', size: 4, name: 'Battleship' },
      { type: 'cruiser', size: 3, name: 'Cruiser' },
      { type: 'submarine', size: 3, name: 'Submarine' },
      { type: 'destroyer', size: 2, name: 'Destroyer' }
    ];

    // Initialize game
    function initGame() {
      createGrids();
      setupEventListeners();
      updateStatus('Select your ships and deploy them on your grid, Admiral!');
    }

    // Create grid displays
    function createGrids() {
      createGrid('player-grid', 'player');
      createGrid('enemy-grid', 'enemy');
    }

    function createGrid(containerId, gridType) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      
      for (let row = 0; row < 10; row++) {
        for (let col = 0; col < 10; col++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.dataset.row = row;
          cell.dataset.col = col;
          cell.dataset.grid = gridType;
          
          if (gridType === 'player') {
            cell.addEventListener('click', () => handlePlayerGridClick(row, col));
            cell.addEventListener('mouseenter', () => showPlacementPreview(row, col));
            cell.addEventListener('mouseleave', () => clearPlacementPreview());
            // Drag-and-drop events
            cell.addEventListener('dragover', handleCellDragOver);
            cell.addEventListener('dragleave', handleCellDragLeave);
            cell.addEventListener('drop', handleCellDrop);
          } else if (gridType === 'enemy' && gamePhase === 'playing') {
            cell.addEventListener('click', () => handleEnemyGridClick(row, col));
          }
          
          container.appendChild(cell);
        }
      }
    }

    // Setup event listeners
    function setupEventListeners() {
      // Mode selection
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.addEventListener('click', () => selectGameMode(btn.dataset.mode));
      });

      // Ship selection (click)
      document.querySelectorAll('.ship-item').forEach(ship => {
        ship.addEventListener('click', () => selectShip(ship));
        // Drag-and-drop events for ships
        ship.addEventListener('dragstart', handleShipDragStart);
        ship.addEventListener('dragend', handleShipDragEnd);
      });

      // Control buttons
      document.getElementById('rotate-btn').addEventListener('click', rotateShip);
      document.getElementById('random-btn').addEventListener('click', randomPlacement);
      document.getElementById('clear-btn').addEventListener('click', clearAllShips);
      document.getElementById('start-btn').addEventListener('click', startGame);

      // Powerups
      document.getElementById('sonar-btn').addEventListener('click', useSonar);
      document.getElementById('airstrike-btn').addEventListener('click', useAirstrike);

      // Drag-and-drop events for player grid cells
      document.querySelectorAll('[data-grid="player"] .cell').forEach(cell => {
        cell.addEventListener('dragover', handleCellDragOver);
        cell.addEventListener('dragleave', handleCellDragLeave);
        cell.addEventListener('drop', handleCellDrop);
      });
    }

    // Game mode selection
    function selectGameMode(mode) {
      gameMode = mode;
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.mode === mode);
      });
      
      const powerupsDiv = document.getElementById('powerups');
      powerupsDiv.style.display = mode === 'advanced' ? 'block' : 'none';
      
      updateStatus(mode === 'classic' 
        ? 'Classic Mode: Traditional naval warfare!' 
        : 'Advanced Mode: Strategic warfare with tactical support!');
    }

    // Ship selection
    function selectShip(shipElement) {
      if (shipElement.classList.contains('placed')) return;
      
      document.querySelectorAll('.ship-item').forEach(s => s.classList.remove('selected'));
      shipElement.classList.add('selected');
      
      const shipType = shipElement.dataset.type;
      selectedShip = SHIPS.find(s => s.type === shipType);
      updateStatus(`${selectedShip.name} selected! Click on your grid to deploy (${orientation}).`);
    }

    // Show placement preview
    function showPlacementPreview(row, col) {
      if (!selectedShip || gamePhase !== 'setup') return;
      
      clearPlacementPreview();
      
      const canPlace = canPlaceShip(playerGrid, row, col, selectedShip.size, orientation);
      
      for (let i = 0; i < selectedShip.size; i++) {
        const targetRow = row + (orientation === 'vertical' ? i : 0);
        const targetCol = col + (orientation === 'horizontal' ? i : 0);
        
        if (targetRow < 10 && targetCol < 10) {
          const cell = document.querySelector(`[data-grid="player"][data-row="${targetRow}"][data-col="${targetCol}"]`);
          if (cell) {
            if (canPlace) {
              cell.classList.add('selected');
            } else {
              cell.classList.add('invalid');
            }
          }
        }
      }
    }

    function clearPlacementPreview() {
      document.querySelectorAll('[data-grid="player"] .cell').forEach(cell => {
        cell.classList.remove('selected', 'invalid');
      });
    }

    // Check if ship can be placed
    function canPlaceShip(grid, row, col, size, orientation) {
      for (let i = 0; i < size; i++) {
        const targetRow = row + (orientation === 'vertical' ? i : 0);
        const targetCol = col + (orientation === 'horizontal' ? i : 0);
        
        if (targetRow >= 10 || targetCol >= 10 || grid[targetRow][targetCol]) {
          return false;
        }
      }
      return true;
    }

    // Handle player grid click (ship placement)
    function handlePlayerGridClick(row, col) {
      if (!selectedShip || gamePhase !== 'setup') return;
      
      if (!canPlaceShip(playerGrid, row, col, selectedShip.size, orientation)) {
        updateStatus('Cannot deploy there, Admiral! Choose different coordinates.');
        return;
      }
      
      placeShip(row, col);
    }

    // Place ship on grid
    function placeShip(row, col) {
      const shipCells = [];
      
      for (let i = 0; i < selectedShip.size; i++) {
        const targetRow = row + (orientation === 'vertical' ? i : 0);
        const targetCol = col + (orientation === 'horizontal' ? i : 0);
        
        playerGrid[targetRow][targetCol] = selectedShip.type;
        shipCells.push({ row: targetRow, col: targetCol });
      }
      
      playerShips.push({
        ...selectedShip,
        cells: shipCells,
        hits: 0,
        sunk: false
      });
      
      // Mark ship as placed
      document.querySelector(`[data-type="${selectedShip.type}"]`).classList.add('placed');
      selectedShip = null;
      
      updatePlayerGrid();
      clearPlacementPreview();
      
      if (playerShips.length === 5) {
        document.getElementById('start-btn').disabled = false;
        updateStatus('Fleet deployed! All ships ready for battle, Admiral!');
      } else {
        updateStatus(`Ship deployed! Select next vessel to deploy.`);
      }
    }

    // Update grid displays
    function updatePlayerGrid() {
      for (let row = 0; row < 10; row++) {
        for (let col = 0; col < 10; col++) {
          const cell = document.querySelector(`[data-grid="player"][data-row="${row}"][data-col="${col}"]`);
          const cellValue = playerGrid[row][col];
          
          cell.className = 'cell';
          if (cellValue && cellValue !== 'hit' && cellValue !== 'miss') {
            cell.classList.add('ship');
          } else if (cellValue === 'hit') {
            cell.classList.add('hit');
            cell.textContent = 'üí•';
          } else if (cellValue === 'miss') {
            cell.classList.add('miss');
            cell.textContent = 'üíß';
          }
        }
      }
    }

    function updateEnemyGrid() {
      for (let row = 0; row < 10; row++) {
        for (let col = 0; col < 10; col++) {
          const cell = document.querySelector(`[data-grid="enemy"][data-row="${row}"][data-col="${col}"]`);
          const cellValue = enemyGrid[row][col];
          
          cell.className = 'cell';
          if (cellValue === 'hit') {
            cell.classList.add('hit');
            cell.textContent = 'üí•';
          } else if (cellValue === 'miss') {
            cell.classList.add('miss');
            cell.textContent = 'üíß';
          }
          
          // Check if part of sunk ship
          const sunkShip = enemyShips.find(ship => 
            ship.sunk && ship.cells.some(c => c.row === row && c.col === col)
          );
          if (sunkShip) {
            cell.classList.add('sunk');
            cell.textContent = 'üî•';
          }
        }
      }
    }

    // Control functions
    function rotateShip() {
      orientation = orientation === 'horizontal' ? 'vertical' : 'horizontal';
      updateStatus(`Ship orientation: ${orientation.toUpperCase()}`);
    }

    function randomPlacement() {
      clearAllShips();
      
      SHIPS.forEach(ship => {
        let placed = false;
        let attempts = 0;
        
        while (!placed && attempts < 100) {
          const row = Math.floor(Math.random() * 10);
          const col = Math.floor(Math.random() * 10);
          const orient = Math.random() > 0.5 ? 'horizontal' : 'vertical';
          
          if (canPlaceShip(playerGrid, row, col, ship.size, orient)) {
            const shipCells = [];
            
            for (let i = 0; i < ship.size; i++) {
              const targetRow = row + (orient === 'vertical' ? i : 0);
              const targetCol = col + (orient === 'horizontal' ? i : 0);
              
              playerGrid[targetRow][targetCol] = ship.type;
              shipCells.push({ row: targetRow, col: targetCol });
            }
            
            playerShips.push({
              ...ship,
              cells: shipCells,
              hits: 0,
              sunk: false
            });
            
            document.querySelector(`[data-type="${ship.type}"]`).classList.add('placed');
            placed = true;
          }
          attempts++;
        }
      });
      
      updatePlayerGrid();
      document.getElementById('start-btn').disabled = false;
      updateStatus('Fleet auto-deployed! All ships battle-ready, Admiral!');
    }

    function clearAllShips() {
      playerGrid = Array(10).fill().map(() => Array(10).fill(null));
      playerShips = [];
      selectedShip = null;
      
      document.querySelectorAll('.ship-item').forEach(ship => {
        ship.classList.remove('placed', 'selected');
      });
      
      document.getElementById('start-btn').disabled = true;
      updatePlayerGrid();
      updateStatus('Fleet cleared. Redeploy your ships for battle.');
    }

    // Start game
    function startGame() {
      if (playerShips.length !== 5) {
        updateStatus('Deploy all ships before battle, Admiral!');
        return;
      }
      
      gamePhase = 'playing';
      document.getElementById('ship-dock').style.display = 'none';
      
      // Place enemy ships
      placeEnemyShips();
      
      // Update enemy grid event listeners
      createGrid('enemy-grid', 'enemy');
      document.querySelectorAll('[data-grid="enemy"] .cell').forEach(cell => {
        cell.addEventListener('click', () => {
          const row = parseInt(cell.dataset.row);
          const col = parseInt(cell.dataset.col);
          handleEnemyGridClick(row, col);
        });
      });
      
      updateStatus('‚öîÔ∏è BATTLE COMMENCED! Target enemy waters and fire, Admiral!');
      updateStats();
    }

    // Place enemy ships randomly
    function placeEnemyShips() {
      enemyGrid = Array(10).fill().map(() => Array(10).fill(null));
      enemyShips = [];
      
      SHIPS.forEach(ship => {
        let placed = false;
        let attempts = 0;
        
        while (!placed && attempts < 100) {
          const row = Math.floor(Math.random() * 10);
          const col = Math.floor(Math.random() * 10);
          const orient = Math.random() > 0.5 ? 'horizontal' : 'vertical';
          
          if (canPlaceShip(enemyGrid, row, col, ship.size, orient)) {
            const shipCells = [];
            
            for (let i = 0; i < ship.size; i++) {
              const targetRow = row + (orient === 'vertical' ? i : 0);
              const targetCol = col + (orient === 'horizontal' ? i : 0);
              
              enemyGrid[targetRow][targetCol] = ship.type;
              shipCells.push({ row: targetRow, col: targetCol });
            }
            
            enemyShips.push({
              ...ship,
              cells: shipCells,
              hits: 0,
              sunk: false
            });
            
            placed = true;
          }
          attempts++;
        }
      });
    }

    // Handle enemy grid attack
    function handleEnemyGridClick(row, col) {
      if (!playerTurn || gamePhase !== 'playing' || gameOver) return;
      
      const cellValue = enemyGrid[row][col];
      
      if (cellValue === 'hit' || cellValue === 'miss') {
        updateStatus('Already targeted those coordinates, Admiral!');
        return;
      }
      
      gameStats.shotsFired++;
      
      if (cellValue && cellValue !== 'hit' && cellValue !== 'miss') {
        // Direct hit!
        enemyGrid[row][col] = 'hit';
        gameStats.hits++;
        gameStats.score += 10;
        
        const hitShip = enemyShips.find(ship => ship.type === cellValue);
        hitShip.hits++;
        
        if (hitShip.hits === hitShip.size) {
          hitShip.sunk = true;
          gameStats.enemyShipsRemaining--;
          gameStats.score += hitShip.size * 20;
          updateStatus(`üéØ DIRECT HIT! Enemy ${hitShip.name} DESTROYED! Continue firing!`);
          
          if (gameStats.enemyShipsRemaining === 0) {
            endGame(true);
            return;
          }
        } else {
          updateStatus('üéØ DIRECT HIT! Enemy vessel damaged! Fire again!');
        }
        
        // Player continues turn after hit
      } else {
        // Miss
        enemyGrid[row][col] = 'miss';
        updateStatus('üíß MISS! Enemy taking evasive action...');
        playerTurn = false;
        
        setTimeout(() => {
          enemyAttack();
        }, 1500);
      }
      
      updateEnemyGrid();
      updateStats();
      updatePowerups();
    }

    // Enemy AI attack
    function enemyAttack() {
      if (playerTurn || gamePhase !== 'playing' || gameOver) return;
      
      let row, col;
      let attempts = 0;
      
      // Simple AI: random attacks
      do {
        row = Math.floor(Math.random() * 10);
        col = Math.floor(Math.random() * 10);
        attempts++;
      } while ((playerGrid[row][col] === 'hit' || playerGrid[row][col] === 'miss') && attempts < 100);
      
      const cellValue = playerGrid[row][col];
      const coords = String.fromCharCode(65 + col) + (row + 1);
      
      if (cellValue && cellValue !== 'hit' && cellValue !== 'miss') {
        // Enemy hit
        playerGrid[row][col] = 'hit';
        
        const hitShip = playerShips.find(ship => ship.type === cellValue);
        hitShip.hits++;
        
        if (hitShip.hits === hitShip.size) {
          hitShip.sunk = true;
          updateStatus(`üíÄ MAYDAY! Enemy destroyed our ${hitShip.name} at ${coords}!`);
          
          const playerShipsRemaining = playerShips.filter(ship => !ship.sunk).length;
          if (playerShipsRemaining === 0) {
            endGame(false);
            return;
          }
        } else {
          updateStatus(`üíÄ INCOMING! Enemy hit our ${hitShip.name} at ${coords}!`);
        }
        
        // Enemy continues after hit
        setTimeout(() => {
          enemyAttack();
        }, 1000);
      } else {
        // Enemy miss
        playerGrid[row][col] = 'miss';
        updateStatus(`üíß Enemy missed at ${coords}! Return fire, Admiral!`);
        playerTurn = true;
      }
      
      updatePlayerGrid();
    }

    // Powerups (Advanced mode)
    function useSonar() {
      if (gameStats.score < 200) return;
      
      gameStats.score -= 200;
      
      // Reveal a random enemy ship position
      const unrevealedShips = enemyShips.filter(ship => !ship.sunk);
      if (unrevealedShips.length > 0) {
        const randomShip = unrevealedShips[Math.floor(Math.random() * unrevealedShips.length)];
        const randomCell = randomShip.cells[Math.floor(Math.random() * randomShip.cells.length)];
        
        // Highlight the revealed cell temporarily
        const cell = document.querySelector(`[data-grid="enemy"][data-row="${randomCell.row}"][data-col="${randomCell.col}"]`);
        const originalBg = cell.style.background;
        const originalBorder = cell.style.border;
        
        cell.style.background = 'linear-gradient(145deg, #fbb040, #ed8936)';
        cell.style.border = '3px solid #dd6b20';
        cell.textContent = 'üì°';
        
        setTimeout(() => {
          cell.style.background = originalBg;
          cell.style.border = originalBorder;
          cell.textContent = '';
        }, 3000);
        
        const coords = String.fromCharCode(65 + randomCell.col) + (randomCell.row + 1);
        updateStatus(`üì° SONAR CONTACT! Enemy vessel detected at ${coords}!`);
        updateStats();
        updatePowerups();
      }
    }

    function useAirstrike() {
      if (gameStats.score < 100) return;
      
      gameStats.score -= 100;
      
      // Attack 5 random cells
      let strikes = 0;
      const maxStrikes = 5;
      let hitResults = [];
      
      while (strikes < maxStrikes) {
        const row = Math.floor(Math.random() * 10);
        const col = Math.floor(Math.random() * 10);
        
        if (enemyGrid[row][col] !== 'hit' && enemyGrid[row][col] !== 'miss') {
          const cellValue = enemyGrid[row][col];
          const coords = String.fromCharCode(65 + col) + (row + 1);
          
          if (cellValue && cellValue !== 'hit' && cellValue !== 'miss') {
            // Hit!
            enemyGrid[row][col] = 'hit';
            gameStats.hits++;
            gameStats.score += 5;
            
            const hitShip = enemyShips.find(ship => ship.type === cellValue);
            hitShip.hits++;
            
            if (hitShip.hits === hitShip.size) {
              hitShip.sunk = true;
              gameStats.enemyShipsRemaining--;
              gameStats.score += hitShip.size * 10;
              hitResults.push(`${coords} - ${hitShip.name} DESTROYED`);
            } else {
              hitResults.push(`${coords} - HIT`);
            }
          } else {
            // Miss
            enemyGrid[row][col] = 'miss';
            hitResults.push(`${coords} - MISS`);
          }
          
          strikes++;
        }
      }
      
      updateEnemyGrid();
      updateStatus(`‚úàÔ∏è AIR STRIKE COMPLETE! Results: ${hitResults.join(', ')}`);
      updateStats();
      updatePowerups();
      
      if (gameStats.enemyShipsRemaining === 0) {
        endGame(true);
      }
    }

    // Update statistics display
    function updateStats() {
      document.getElementById('player-score').textContent = gameStats.score;
      document.getElementById('shots-fired').textContent = gameStats.shotsFired;
      document.getElementById('hit-ratio').textContent = 
        gameStats.shotsFired > 0 ? Math.round((gameStats.hits / gameStats.shotsFired) * 100) + '%' : '0%';
      document.getElementById('ships-remaining').textContent = gameStats.enemyShipsRemaining;
    }

    // Update powerup button states
    function updatePowerups() {
      if (gameMode === 'advanced') {
        const sonarBtn = document.getElementById('sonar-btn');
        const airstrikeBtn = document.getElementById('airstrike-btn');
        
        sonarBtn.disabled = gameStats.score < 200;
        airstrikeBtn.disabled = gameStats.score < 100;
        
        sonarBtn.textContent = gameStats.score >= 200 ? 'üì° Sonar Scan (200pts) - READY' : `üì° Sonar Scan (${200 - gameStats.score} pts needed)`;
        airstrikeBtn.textContent = gameStats.score >= 100 ? '‚úàÔ∏è Air Strike (100pts) - READY' : `‚úàÔ∏è Air Strike (${100 - gameStats.score} pts needed)`;
      }
    }

    // End game
    function endGame(playerWon) {
      gamePhase = 'ended';
      gameOver = true;
      
      const modal = document.createElement('div');
      modal.className = 'game-over-modal';
      
      const finalScore = gameStats.score;
      const accuracy = gameStats.shotsFired > 0 ? Math.round((gameStats.hits / gameStats.shotsFired) * 100) : 0;
      
      modal.innerHTML = `
        <div class="modal-content">
          <h2>${playerWon ? 'üéâ VICTORY ACHIEVED! üéâ' : 'üíÄ MISSION FAILED üíÄ'}</h2>
          <p><strong>${playerWon ? 'Outstanding work, Admiral! Enemy fleet completely destroyed!' : 'Enemy has sunk our entire fleet! Better luck next time, Admiral.'}</strong></p>
          <div style="margin: 20px 0; text-align: left;">
            <div><strong>Final Score:</strong> ${finalScore} points</div>
            <div><strong>Shots Fired:</strong> ${gameStats.shotsFired}</div>
            <div><strong>Hit Accuracy:</strong> ${accuracy}%</div>
            <div><strong>Game Mode:</strong> ${gameMode.charAt(0).toUpperCase() + gameMode.slice(1)}</div>
          </div>
          <button onclick="location.reload()">üîÑ New Battle</button>
          <button onclick="document.querySelector('.game-over-modal').remove()">üìä Review Battle</button>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    // Update status message
    function updateStatus(message) {
      document.getElementById('status').textContent = message;
    }

    // Drag-and-drop handlers for ships
    let draggedShip = null;
    function handleShipDragStart(e) {
      if (this.classList.contains('placed')) {
        e.preventDefault();
        return;
      }
      draggedShip = SHIPS.find(s => s.type === this.dataset.type);
      // Store ship type and orientation in dataTransfer
      e.dataTransfer.setData('text/plain', JSON.stringify({
        type: draggedShip.type,
        size: draggedShip.size,
        orientation: orientation
      }));
      // Optional: highlight possible drop targets
    }
    function handleShipDragEnd(e) {
      draggedShip = null;
      clearPlacementPreview();
    }

    // Drag-and-drop handlers for grid cells
    function handleCellDragOver(e) {
      e.preventDefault(); // Allow drop
      if (!draggedShip || gamePhase !== 'setup') return;
      const row = parseInt(this.dataset.row);
      const col = parseInt(this.dataset.col);
      const canDeploy = canPlaceShip(playerGrid, row, col, draggedShip.size, orientation);
      // Show preview for dragged ship
      selectedShip = draggedShip;
      showPlacementPreview(row, col);
      // No need to add extra classes here; showPlacementPreview handles visual feedback
    }
    function handleCellDragLeave(e) {
      clearPlacementPreview();
    }
    function handleCellDrop(e) {
      e.preventDefault();
      if (!draggedShip || gamePhase !== 'setup') return;
      const row = parseInt(this.dataset.row);
      const col = parseInt(this.dataset.col);
      if (!canPlaceShip(playerGrid, row, col, draggedShip.size, orientation)) {
        updateStatus('DEPLOYMENT BLOCKED - SELECT ALTERNATIVE COORDINATES');
        clearPlacementPreview();
        return;
      }
      // Place the ship
      selectedShip = draggedShip;
      placeShip(row, col);
      draggedShip = null;
      clearPlacementPreview();
    }

    // Initialize game when page loads
    document.addEventListener('DOMContentLoaded', () => {
      initGame();
    });
  </script>
</body>
</html>
