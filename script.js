const SHIPS=[{type:"carrier",size:5},{type:"battleship",size:4},{type:"cruiser",size:3},{type:"submarine",size:3},{type:"destroyer",size:2}];let playerGrid=Array(10).fill().map(()=>Array(10).fill(null)),aiGrid=Array(10).fill().map(()=>Array(10).fill(null)),placedShips=[],selectedShip=null,orientation="horizontal",gamePhase="strategy";function renderGrid(e,t,i=!1){const n=document.getElementById(e);n.innerHTML="";for(let r=0;r<10;r++)for(let l=0;l<10;l++){const a=document.createElement("div");a.classList.add("cell"),t[r][l]&&"hit"!==t[r][l]&&"miss"!==t[r][l]&&i&&a.classList.add("ship"),"hit"===t[r][l]&&a.classList.add("hit"),"miss"===t[r][l]&&a.classList.add("miss"),"strategy"===gamePhase&&"strategy-grid"===e&&(a.addEventListener("mouseenter",()=>highlightPlacement(r,l)),a.addEventListener("mouseleave",()=>renderGrid("strategy-grid",playerGrid,!0)),a.addEventListener("click",()=>placeShip(r,l))),"gameplay"===gamePhase&&"ai-board"===e&&a.addEventListener("click",()=>handlePlayerAttack(r,l)),n.appendChild(a)}}function highlightPlacement(e,t){if(renderGrid("strategy-grid",playerGrid,!0),!selectedShip)return;const i=document.getElementById("strategy-grid"),n=canPlaceShip(playerGrid,e,t,selectedShip.size,orientation);for(let r=0;r<selectedShip.size;r++){let l=e+("vertical"===orientation?r:0),a=t+("horizontal"===orientation?r:0);l<10&&a<10&&(i.children[10*l+a].classList.add("selected"),n||(i.children[10*l+a].style.background="#e74c3c"))}}function canPlaceShip(e,t,i,n,r){if("horizontal"===r){if(i+n>10)return!1;for(let r=0;r<n;r++)if(e[t][i+r])return!1}else{if(t+n>10)return!1;for(let r=0;r<n;r++)if(e[t+r][i])return!1}return!0}function placeShip(e,t){if(!selectedShip)return;if(!canPlaceShip(playerGrid,e,t,selectedShip.size,orientation))return void updateStatus("Invalid placement!");for(let i=0;i<selectedShip.size;i++){let n=e+("vertical"===orientation?i:0),r=t+("horizontal"===orientation?i:0);playerGrid[n][r]=selectedShip.type}placedShips.push({...selectedShip,row:e,col:t,orientation}),document.querySelector(`.ship-silhouette[data-type="${selectedShip.type}"]`).classList.add("placed"),selectedShip=null,renderGrid("strategy-grid",playerGrid,!0),updateStatus("Ship placed!")}function updateStatus(e){document.getElementById("status").textContent=e}function resetStrategy(){playerGrid=Array(10).fill().map(()=>Array(10).fill(null)),placedShips=[],selectedShip=null,document.querySelectorAll(".ship-silhouette").forEach(e=>{e.classList.remove("placed","selected")}),renderGrid("strategy-grid",playerGrid,!0),updateStatus("Click a ship to place it.")}function rotateShip(){orientation="horizontal"===orientation?"vertical":"horizontal",updateStatus(`Orientation: ${orientation}`)}function deleteShip(){if(!selectedShip)return;for(let e=0;e<placedShips.length;e++)if(placedShips[e].type===selectedShip.type){let{row:t,col:i,size:n,orientation:r}=placedShips[e];for(let l=0;l<n;l++){let a=t+("vertical"===r?l:0),d=i+("horizontal"===r?l:0);playerGrid[a][d]=null}placedShips.splice(e,1);break}document.querySelector(`.ship-silhouette[data-type="${selectedShip.type}"]`).classList.remove("placed"),renderGrid("strategy-grid",playerGrid,!0),updateStatus("Ship deleted.")}function closeStrategyPanel(){document.getElementById("strategy-panel").style.display="none",gamePhase="gameplay",aiGrid=Array(10).fill().map(()=>Array(10).fill(null)),placeAIShips(),renderGrid("ai-board",aiGrid,!1),renderGrid("strategy-grid",playerGrid,!0),updateStatus("Game started! Attack the AI board.")}function placeAIShips(){SHIPS.forEach(e=>{let t=!1,i=0;for(;!t&&i<100;){let n=Math.random()>.5?"horizontal":"vertical",r=Math.floor(10*Math.random()),l=Math.floor(10*Math.random());if(canPlaceShip(aiGrid,r,l,e.size,n)){for(let a=0;a<e.size;a++){let d=r+("vertical"===n?a:0),o=l+("horizontal"===n?a:0);aiGrid[d][o]=e.type}t=!0}i++}})}function handlePlayerAttack(e,t){"gameplay"===gamePhase&&("hit"!==aiGrid[e][t]&&"miss"!==aiGrid[e][t]&&(aiGrid[e][t]?aiGrid[e][t]="hit":aiGrid[e][t]="miss",updateStatus(aiGrid[e][t]==="hit"?"Hit!":"Miss!"),renderGrid("ai-board",aiGrid,!1)))}document.addEventListener("DOMContentLoaded",()=>{renderGrid("strategy-grid",playerGrid,!0),renderGrid("ai-board",aiGrid,!1),updateStatus("Click a ship to place it."),document.querySelectorAll(".ship-silhouette").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".ship-silhouette").forEach(e=>e.classList.remove("selected")),e.classList.add("selected"),selectedShip=SHIPS.find(t=>t.type===e.dataset.type),updateStatus(`Placing: ${selectedShip.type} (${orientation})`)})}),document.getElementById("rotate-btn").addEventListener("click",rotateShip),document.getElementById("reset-btn").addEventListener("click",resetStrategy),document.getElementById("delete-btn").addEventListener("click",deleteShip),document.getElementById("close-btn").addEventListener("click",closeStrategyPanel)}); 